{% extends 'layout.html' %}
{% block title %}Settings{% endblock %}
{% block content %}
<nav class="top-nav"><a class="home" href="{{ url_for('home') }}">üè† Home</a> ¬∑ <a class="back" href="javascript:history.back()">‚Üê Back</a></nav>

<a class="back" href="{{ url_for('home') }}">‚Üê Back</a>
<section class="card">
  <h2>Settings</h2><p class="muted">Enter password to save settings or manage categories.</p>
  <form method="post" class="form">
    <label>Title</label>
    <input type="text" name="title" value="{{ settings.get('title','National Gymnastics Rankings ‚Äì Romania') }}">
    <label>Subtitle</label>
    <input type="text" name="subtitle" value="{{ settings.get('subtitle','Official RENC') }}">
    <div class="grid">
      <div>
        <label>Date</label>
        <input type="date" name="event_date" value="{{ settings.get('event_date','') }}">
      </div>
      <div>
        <label>Location</label>
        <input type="text" name="location" value="{{ settings.get('location','') }}">
      </div>
    </div>
    <label>Settings password (same as upload)</label>
    <input type="password" name="password">
    <button class="btn btn-primary" type="submit">Save</button>
  </form>
  <hr class="divider" style="margin-top:16px">
  <h3>Categories</h3>
  <ul>
    {% for c in (categories or {}).values() %}
      <li><a href="{{ url_for('category_page', slug=c.slug) }}">{{ c.name }}</a></li>
    {% endfor %}
  </ul>

<hr class="sep">

<h2>Category Manager</h2>
<p class="muted">Aici poti sterge sau redenumi rapid categoriile existente. Actiunile cer parola de upload.</p>

<form method="post" action="{{ url_for('settings_page') }}" class="form" style="margin-bottom:16px;">
  <input type="hidden" name="action" value="add_cat">
  <label>Adauga categorie noua</label>
  <input type="text" name="new_category" placeholder="ex: Individual Women ‚Äì Junior">
  <label>Parola</label>
  <input type="password" name="password" placeholder="Parola upload">
  <button class="btn btn-primary" type="submit">Adauga</button>
</form>

<div class="cards">
  {% for c in cats %}
    <div class="card" style="margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <div><strong>{{ c.name }}</strong></div>
          <div class="muted">slug: {{ c.slug }} ‚Ä¢ randuri: {{ cat_counts.get(c.slug, 0) }}</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <form method="post" action="{{ url_for('settings_rename_category') }}" class="inline-form" onsubmit="return confirm('Redenumesti aceasta categorie?');">
            <input type="hidden" name="slug" value="{{ c.slug }}">
            <input type="text" name="new_name" placeholder="Nume nou">
            <input type="password" name="password" placeholder="Parola">
            <button class="btn">Redenumeste</button>
          </form>
          <form method="post" action="{{ url_for('settings_delete_category') }}" class="inline-form" onsubmit="return confirm('Sigur stergi aceasta categorie si toate randurile ei?');">
            <input type="hidden" name="slug" value="{{ c.slug }}">
            <input type="password" name="password" placeholder="Parola">
            <button class="btn btn-danger">Sterge</button>
          </form>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

</section>
{% endblock %}

<section class="card">
  <h3>Categories</h3>
  <form method="post" class="form" style="margin-bottom:12px">
    <input type="hidden" name="action" value="add_cat">
    <label>Add new category</label>
    <input type="text" name="new_category" placeholder="Category name">
    <label>Password</label>
    <input type="password" name="password">
    <button class="btn btn-primary" type="submit">Add</button>
  </form>

  <div class="table-wrap">
    <table class="rank-table">
      <thead><tr><th>Name</th><th style="width:40%">Rename</th><th style="width:20%">Actions</th></tr></thead>
      <tbody>
        {% for c in cats %}
        <tr>
          <td>{{ c.name }}</td>
          <td>
            <form method="post" class="form" style="grid-template-columns: 1fr auto">
              <input type="hidden" name="action" value="rename_cat">
              <input type="hidden" name="cat_id" value="{{ c.id }}">
              <input type="text" name="cat_new_name" placeholder="New name">
              <input type="password" name="password">
              <button class="btn" type="submit">Rename</button>
            </form>
          </td>
          <td>
            <form method="post" onsubmit="return confirm('Delete category and all its rows?');">
              <input type="hidden" name="action" value="delete_cat">
              <input type="hidden" name="cat_id" value="{{ c.id }}">
              <input type="password" name="password">
              <button class="btn" type="submit">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

<hr class="sep">

<h2>Category Manager</h2>
<p class="muted">Aici poti sterge sau redenumi rapid categoriile existente. Actiunile cer parola de upload.</p>

<form method="post" action="{{ url_for('settings_page') }}" class="form" style="margin-bottom:16px;">
  <input type="hidden" name="action" value="add_cat">
  <label>Adauga categorie noua</label>
  <input type="text" name="new_category" placeholder="ex: Individual Women ‚Äì Junior">
  <label>Parola</label>
  <input type="password" name="password" placeholder="Parola upload">
  <button class="btn btn-primary" type="submit">Adauga</button>
</form>

<div class="cards">
  {% for c in cats %}
    <div class="card" style="margin-bottom:12px;">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <div><strong>{{ c.name }}</strong></div>
          <div class="muted">slug: {{ c.slug }} ‚Ä¢ randuri: {{ cat_counts.get(c.slug, 0) }}</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <form method="post" action="{{ url_for('settings_rename_category') }}" class="inline-form" onsubmit="return confirm('Redenumesti aceasta categorie?');">
            <input type="hidden" name="slug" value="{{ c.slug }}">
            <input type="text" name="new_name" placeholder="Nume nou">
            <input type="password" name="password" placeholder="Parola">
            <button class="btn">Redenumeste</button>
          </form>
          <form method="post" action="{{ url_for('settings_delete_category') }}" class="inline-form" onsubmit="return confirm('Sigur stergi aceasta categorie si toate randurile ei?');">
            <input type="hidden" name="slug" value="{{ c.slug }}">
            <input type="password" name="password" placeholder="Parola">
            <button class="btn btn-danger">Sterge</button>
          </form>
        </div>
      </div>
    </div>
  {% endfor %}
</div>

</section>
